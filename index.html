<!DOCTYPE html>
<html>
  <head>
    <title>AJAX to Python server</title>
    <script>
      // function sendToServer() {
      //   var xhr = new XMLHttpRequest();
      //   var url = "http://127.0.0.1:5000"; // DONE Replace with your Python server URL
      //   var payload = {
      //     "name": "John Doe",
      //     "age": 30,
      //     "city": "New York"
      //   };
      //   xhr.open("POST", url);
      //   xhr.setRequestHeader("Content-Type", "application/json");
      //   xhr.send(JSON.stringify(payload));
        
      // }

      let count = 0; // Initialize the count variable to 0


      function sendIP() {
      // Make an HTTP POST request to the server on port 5000
      const xhr = new XMLHttpRequest();
      const url = "http://127.0.0.1:5000"; // Replace with the URL of your server
      const ip = document.getElementById('ip-address').textContent.trim(); // Get the IP address from the 'ip-address' element
      xhr.open('POST', url);
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.onload = function() {
        if (xhr.status === 200) {
          console.log('IP address sent successfully');
        } else {
          console.error('Error sending IP address:', xhr.statusText);
        }
      };
      xhr.send(JSON.stringify({ip:ip}));
      document.getElementById("ints").innerText = "Interesante Clickeaste el boton"
    }
    function countClicks() {
      // Increment the count variable and display it on the page
      count++;
      document.getElementById('ip-address1').textContent = count;
      if (count == 10) {
            const algo = document.createElement('p')
            algo.innerText = "No va a pasar nada, el boton no es muy util..."
            document.body.appendChild(algo)
      }
    }
    function OS(){
      const xhr = new XMLHttpRequest();
      const url = "http://127.0.0.1:5000";
      xhr.open('POST', url);
      xhr.setRequestHeader('Content-Type', 'application/json');
      const userAgent = window.navigator.userAgent;
      const platform = window.navegator.platform;
      const macs = ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'];
      const windowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'];
      const iosPlatforms = ['iPhone', 'iPad', 'iPod'];
      if (macosPlatforms.indexOf(platform) !== -1) {
        xhr.send(JSON.stringify('Mac OS'));
      } else if (iosPlatforms.indexOf(platform) !== -1) {
        xhr.send(JSON.stringify('iOS'));
      } else if (windowsPlatforms.indexOf(platform) !== -1) {
        xhr.send(JSON.stringify('Windows'));
      } else if (/Android/.test(userAgent)) {
        xhr.send(JSON.stringify('Android'));
      } else if (/Linux/.test(platform)) {
        xhr.send(JSON.stringify('Linux'));
      }
      
      return 'Unknown OS';
    }

      function getIP() {
        fetch('https://api.ipify.org?format=json')
          .then(response => response.json())
          .then(data => {
            document.getElementById('ip-address').textContent = data.ip;
          })
          .catch(error => {
            console.error('Error fetching IP address:', error);
            document.getElementById('ip-address').textContent = 'Error fetching IP address';
          });
      }
      getIP();

    </script>
  </head>
  <body>
    <h1>AJAX to Python server</h1>
    <!-- <button type="button" onclick="sendToServer()">Send to Python server</button> -->
    <p id="ip-address" style="display: none;"></p>
    <button type="button" onclick="sendIP();countClicks(); OS()">CLICK?</button>
    <p> clickeaste <span id="ip-address1">0</span> VECES PUTO</p>
    <a id="ints"></a>
  </body>
</html>
